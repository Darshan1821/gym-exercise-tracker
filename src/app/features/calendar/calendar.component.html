<div class="p-4 sm:p-6 max-w-7xl mx-auto">

  <!-- Header -->
  <div class="flex justify-between items-center mb-3">
    <button (click)="prevMonth()">‹</button>
    <h2 class="font-semibold">{{ currentDate | date:'MMMM yyyy' }}</h2>
    <button (click)="nextMonth()">›</button>
  </div>

  <!-- Mobile filter toggle -->
  <div class="sm:hidden mb-3">
    <button class="w-full border rounded px-4 py-2" (click)="toggleLegend()">
      Filters
    </button>
  </div>

  <!-- Legend -->
  <div *ngIf="isLegendOpen || isDesktop" class="mb-4 flex flex-wrap gap-3">
    <button (click)="showAllPeople()">Show all</button>
    <button (click)="clearAllPeople()">Clear</button>

    <div *ngFor="let p of people" (click)="togglePerson(p.id!)" class="flex items-center gap-2 cursor-pointer"
      [class.opacity-40]="!activePersonIds.has(p.id!)">
      <span class="w-3 h-3 rounded-full" [style.background]="getPersonColor(p.id!)"></span>
      {{ p.firstName }}
    </div>
  </div>

  <!-- Desktop calendar -->
  <div class="hidden sm:grid grid-cols-7 gap-2">
    <div *ngFor="let day of calendarDays" class="border rounded p-2 h-[96px]" [class.bg-black]="isToday(day)"
      [class.text-white]="isToday(day)">
      <div class="h-full cursor-pointer flex flex-col" (click)="openDay(day)">
        <div class="text-xs font-medium">{{ day.getDate() }}</div>

        <div class="mt-auto flex gap-1">
          <div *ngFor="let g of slotsGroupedByPerson(day)"
            class="w-4 h-4 text-xs rounded-full text-white flex items-center justify-center"
            [style.background]="getPersonColor(g[0])">
            {{ g[1] }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile calendar -->
  <div class="sm:hidden space-y-3 mt-4">
    <div *ngFor="let day of calendarDays" class="border p-3 rounded">
      <div (click)="openDay(day)">
        <div class="font-semibold">
          {{ day | date:'EEE, dd MMM' }}
        </div>

        <div class="flex gap-2 mt-1 flex-wrap">
          <span *ngFor="let g of slotsGroupedByPerson(day)" class="text-xs px-2 rounded-full text-white"
            [style.background]="getPersonColor(g[0])">
            {{ getPersonName(g[0]) }} · {{ g[1] }}
          </span>
        </div>
      </div>
    </div>
  </div>

</div>